$d = "~/Development"
$icloud = '~/Library/Mobile Documents/com~apple~CloudDocs'

def _patch_EnvPath():
    from xonsh.tools import EnvPath
    import os.path
    
    def append_shell(self, shell_str, use_abs_path=False):
        """Appends a shell string to the path. The shell string may contain : as separators"""
        paths = EnvPath(shell_str)
        for path in paths:
            if path in self:
                continue
            if use_abs_path:
                path = os.path.abspath(path)
            if path in self:
                continue
            # this is a bugfix: path_helper sometimes appends ; to a path although it should not
            if not os.path.exists(path) and os.path.exists(path[:-1]):
                path = path[:-1]
            self.append(path)
    EnvPath.append_shell = append_shell

def _relpath(*args):
    import os.path
    return os.path.join(os.path.dirname(__file__), *args)

def _path_from_helper():
    from shlex import split
    return split($(/usr/libexec/path_helper -c))[-1]

_patch_EnvPath()
$PATH.append_shell(_path_from_helper(), True)
$PATH.append_shell(_relpath('..', '..', 'bin'), True)

# Xonsh-Configuration variables

$AUTO_PUSHD = True
#$COMPLETIONS_CONFIRM = True
$XONSH_AUTOPAIR = False
$XONSH_COLOR_STYLE =  "native" #"fruity"
$DYNAMIC_CWD_WIDTH = '25%'
$XONSH_STDERR_PREFIX = "{BACKGROUND_RED}"
$XONSH_STDERR_POSTFIX = "{NO_COLOR}"

# prompt

if $PROMPT_FIELDS['prompt_end'] == '#':
    $PROMPT_FIELDS['prompt_end'] = '{RED}#'
else:
    $PROMPT_FIELDS['prompt_end'] = '{INTENSE_GREEN}$'

$PROMPT = "{env_name:{} }{BLUE}{short_cwd} {prompt_end}{NO_COLOR} "
$BOTTOM_TOOLBAR = "{$XONSH_VERSION} {INTENSE_YELLOW}{user}{BOLD_GREEN}@{#ff1493}{hostname}{gitstatus:{{BOLD_GREEN}}|{}}"

$MULTILINE_PROMPT='{INTENSE_GREEN}.'

# other variables

$CLICOLOR = True
$LSCOLORS = "gxfxcxcxbxehbhAbcbCgBg" # from http://geoff.greer.fm/lscolors/"
$EDITOR = "/usr/local/bin/mate"
$VISUAL = "$EDITOR -w -l"

# aliases

aliases["grep"] = "grep --color=auto"
aliases["rt"] = "rmtrash"
aliases["cdf"] = lambda: aliases["cd"]([$(pwdf)[:-1]])
aliases["ssh"] = "assh wrapper ssh"
aliases["ql"] = "qlmanage -p"

# xontribs

xontrib load vox
xontrib load autoxsh

# cleanup

del _relpath
